<?xml version="1.0" encoding="utf-8"?>
<Grid xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
      xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
      xmlns:showHidePasswordTrigger="clr-namespace:ShowHidePasswordTrigger;assembly=PassGen.Maui"
      xmlns:local="clr-namespace:PassGen.Maui;assembly=PassGen.Maui"
      xmlns:showHidePasswordEntryPrivate="clr-namespace:PassGen.Maui.ShowHidePasswordEntryPrivate;assembly=PassGen.Maui"
      x:Class="PassGen.Maui.ShowHidePasswordEntry">
    <Grid.Resources>
        <local:DoubleWithFactorConverter x:Key="ShowHideHeightConverter" Factor="0.4"/>
        <local:DoubleWithFactorToThicknessConverter x:Key="ShowHideRightMarginConverter" ThicknessFactor="0, 0, 0.5, 0"/>
    </Grid.Resources>
    <showHidePasswordEntryPrivate:PassEntry
        x:Name="_mainEntry"
        IsPassword="{Binding Source={x:Reference _showHideTriggerAction}, Path=HidePassword}"
        Text="{Binding Source={RelativeSource AncestorType={x:Type local:ShowHidePasswordEntry}}, Path=Text, Mode=TwoWay}"
        Placeholder="{Binding Source={RelativeSource AncestorType={x:Type local:ShowHidePasswordEntry}}, Path=Placeholder}"
        IsSpellCheckEnabled="False"
        IsTextPredictionEnabled="False">
        <Entry.Keyboard>
            <Keyboard x:FactoryMethod="get_Plain"/>
        </Entry.Keyboard>
    </showHidePasswordEntryPrivate:PassEntry>
    <ImageButton VerticalOptions="Center"
                 HorizontalOptions="End"
                 Source="ic_eye"
                 HeightRequest="{Binding Source={x:Reference _mainEntry}, Path=Height, Converter={StaticResource ShowHideHeightConverter}}"
                 Margin="{Binding Source={RelativeSource Self}, Path=Width, Converter={StaticResource ShowHideRightMarginConverter}}">
        <ImageButton.Triggers>
            <EventTrigger Event="Clicked">
                <showHidePasswordTrigger:ShowPasswordTriggerAction
                    x:Name="_showHideTriggerAction"
                    ShowIcon="ic_eye"
                    HideIcon="ic_eye_hide"/>
            </EventTrigger>
        </ImageButton.Triggers>
    </ImageButton>
</Grid>